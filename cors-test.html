<!DOCTYPE html>
<html>
    <head>
        <title>CORS Test - TourOptimizer</title>
        <style>
            body {
                font-family: system-ui;
                max-width: 800px;
                margin: 50px auto;
                padding: 20px;
                background: #0f172a;
                color: white;
            }
            button {
                background: #6366f1;
                color: white;
                padding: 15px 30px;
                border: none;
                border-radius: 8px;
                font-size: 16px;
                cursor: pointer;
                margin: 10px 0;
            }
            button:hover {
                background: #4f46e5;
            }
            .result {
                background: #1e293b;
                padding: 20px;
                border-radius: 8px;
                margin: 20px 0;
                white-space: pre-wrap;
                word-wrap: break-word;
            }
            .success {
                border-left: 4px solid #10b981;
            }
            .error {
                border-left: 4px solid #ef4444;
            }
        </style>
    </head>
    <body>
        <h1>üîç CORS Debug Tool</h1>
        <p>Test if your API has proper CORS headers</p>

        <button onclick="testHealth()">Test /api/health</button>
        <button onclick="testGenerateTour()">Test /api/generate-tour</button>
        <button onclick="testWithOptions()">Test OPTIONS Preflight</button>

        <div id="result"></div>

        <script>
            const API_URL = "https://touroptimizer-backend.onrender.com/api";

            function showResult(title, data, isError = false) {
                const resultDiv = document.getElementById("result");
                resultDiv.className =
                    "result " + (isError ? "error" : "success");
                resultDiv.innerHTML = `<h3>${title}</h3><pre>${JSON.stringify(
                    data,
                    null,
                    2
                )}</pre>`;
            }

            async function testHealth() {
                console.log("Testing /api/health...");
                try {
                    const response = await fetch(`${API_URL}/health`);
                    console.log("Response status:", response.status);
                    console.log("Response headers:", [
                        ...response.headers.entries(),
                    ]);

                    const data = await response.json();
                    showResult("‚úÖ Health Check Success", {
                        status: response.status,
                        headers: {
                            "access-control-allow-origin": response.headers.get(
                                "access-control-allow-origin"
                            ),
                            "access-control-allow-methods":
                                response.headers.get(
                                    "access-control-allow-methods"
                                ),
                            "access-control-allow-headers":
                                response.headers.get(
                                    "access-control-allow-headers"
                                ),
                        },
                        data: data,
                    });
                } catch (error) {
                    console.error("Error:", error);
                    showResult(
                        "‚ùå Health Check Failed",
                        {
                            error: error.message,
                            stack: error.stack,
                        },
                        true
                    );
                }
            }

            async function testGenerateTour() {
                console.log("Testing /api/generate-tour...");
                try {
                    const response = await fetch(`${API_URL}/generate-tour`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            genre: "country",
                            numStops: 5,
                        }),
                    });

                    console.log("Response status:", response.status);
                    console.log("Response headers:", [
                        ...response.headers.entries(),
                    ]);

                    const data = await response.json();
                    showResult("‚úÖ Generate Tour Success", {
                        status: response.status,
                        headers: {
                            "access-control-allow-origin": response.headers.get(
                                "access-control-allow-origin"
                            ),
                        },
                        stops: data.stops?.length || 0,
                        summary: data.summary,
                    });
                } catch (error) {
                    console.error("Error:", error);
                    showResult(
                        "‚ùå Generate Tour Failed",
                        {
                            error: error.message,
                            type: error.name,
                            message: "Check console for full error",
                        },
                        true
                    );
                }
            }

            async function testWithOptions() {
                console.log("Testing OPTIONS preflight...");
                try {
                    const response = await fetch(`${API_URL}/generate-tour`, {
                        method: "OPTIONS",
                    });

                    console.log("OPTIONS Response status:", response.status);
                    console.log("OPTIONS Response headers:", [
                        ...response.headers.entries(),
                    ]);

                    showResult("‚úÖ OPTIONS Preflight", {
                        status: response.status,
                        headers: {
                            "access-control-allow-origin": response.headers.get(
                                "access-control-allow-origin"
                            ),
                            "access-control-allow-methods":
                                response.headers.get(
                                    "access-control-allow-methods"
                                ),
                            "access-control-allow-headers":
                                response.headers.get(
                                    "access-control-allow-headers"
                                ),
                            "access-control-max-age": response.headers.get(
                                "access-control-max-age"
                            ),
                        },
                    });
                } catch (error) {
                    console.error("Error:", error);
                    showResult(
                        "‚ùå OPTIONS Failed",
                        {
                            error: error.message,
                        },
                        true
                    );
                }
            }

            // Auto-test on load
            window.addEventListener("load", () => {
                console.log("Page loaded, API URL:", API_URL);
            });
        </script>
    </body>
</html>
